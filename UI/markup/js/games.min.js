var Games=function(a,b){this.ajax=a,this.urls=b};Games.prototype.deleteGame=function(){var a=$.Deferred();return this.ajax.ajaxDelete(this.urls.deletegame,this.ajax.getIdJson()).done(function(b){a.resolve(b)}).fail(function(b){a.reject(b)}),a},Games.prototype.updateGame=function(){var a=$.Deferred(),b=this.getGameNoId();return b.id=this.ajax.getIdJson().id,this.validateSaveGame(b)?this.ajax.ajaxSave(urls.updategame,b,urls.allgames).done(function(b){a.resolve(b)}).fail(function(b){a.reject(b)}):a.reject(),a},Games.prototype.saveGame=function(){var a=new $.Deferred,b=this.getGameNoId();return this.validateSaveGame(b)?this.ajax.ajaxSave(urls.savegame,b).done(function(b){a.resolve(b)}).fail(function(b){a.reject(b)}):a.reject(),a},Games.prototype.getGameNoId=function(){return{title:$("#title").val(),genre:$("#genre").val(),platform:$("#platform").val(),numcopies:$("#numcopies").val(),numboxed:$("#numboxed").val(),nummanuals:$("#nummanuals").val(),datepurchased:$("#datepurchased").val(),approximatepurchaseddate:$("#approximatepurchaseddate").is(":checked"),notes:$("#notes").val()}},Games.prototype.validateSaveGame=function(a){this.ajax.hideValidationFailure();var b="";""===a.title&&(b="Please enter a title"),""===a.numcopies&&(b=this.ajax.appendText(b,"Please enter a number of copies")),""===a.numboxed&&(b=this.ajax.appendText(b,"Please enter a number of boxes")),""===a.nummanuals&&(b=this.ajax.appendText(b,"Please enter a number of manuals"));var c=""===b;return c||this.ajax.showValidationFailure(b),c},Games.prototype.sortGames=function(a){var b=$("#gamesortfield"),c=$("#gamesortdir"),d=$("#gamerows"),e=c.val(),f="asc",g=null===d.val()?999999:d.val();b.val()==a&&(f=toggleSortDirection(e)),b.val(a),c.val(f);var h={field:a,sortdir:f,numrows:g};this.ajax.loadAjax("#games",urls.sortgames,h,this.initSorting)},Games.prototype.initSorting=function(a,b){"1"!==b&&(a=new Games(new Ajax,urls)),$("a.sortgamestitle").on("click",function(){a.sortGames("title")}),$("a.sortgamesplatform").on("click",function(){a.sortGames("platform")}),$("a.sortgamesnumcopies").on("click",function(){a.sortGames("numcopies")})},$(function(){var a=$(".picker"),b=a.val();a.datepicker(),a.datepicker("option","dateFormat","dd/mm/yy"),a.val(b);var c=new Games(new Ajax,urls);c.initSorting(c,"1"),$("input.saveButton").on("click",function(){"/editgame"===document.location.pathname&&c.updateGame().done(function(){document.location="/allgames"}),"/addgame"==document.location.pathname&&c.saveGame().done(function(){document.location="/allgames"})}),$("a.yesDelete").on("click",function(a){a.preventDefault(),c.deleteGame().done(function(){document.location="/allgames"})})});
//# sourceMappingURL=script.min.js.map