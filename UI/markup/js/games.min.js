var Games=function(a,b){this.ajax=a,this.urls=b};Games.prototype.deleteGame=function(){var a=$.Deferred();return this.ajax.ajaxDelete(this.urls.deletegame,this.ajax.getIdJson()).done(function(b){a.resolve(b)}).fail(function(b){a.reject(b)}),a},Games.prototype.updateGame=function(a,b){var c=$.Deferred(),d=a.getGameNoId();d.id=b.getIdJson().id;var e=a.validateSaveGameJson(d);return"fail"===e.result?(c.reject({fields:e.fields}),c):(b.ajaxSave(urls.updategame,d).done(function(a){c.resolve(a)}).fail(function(a){c.reject(a)}),c)},Games.prototype.saveGame=function(a,b){var c=new $.Deferred,d=a.getGameNoId(),e=a.validateSaveGameJson(d);return"fail"===e.result?(c.reject({fields:e.fields}),c):(b.ajaxSave(urls.savegame,d).done(function(a){c.resolve(a)}).fail(function(a){c.reject(a)}),c)},Games.prototype.getGameNoId=function(){return{title:$("#title").val(),genre:$("#genre").val(),platform:$("#platform").val(),numcopies:$("#numcopies").val(),numboxed:$("#numboxed").val(),nummanuals:$("#nummanuals").val(),datepurchased:$("#datepurchased").val(),approximatepurchaseddate:$("#approximatepurchaseddate").is(":checked"),notes:$("#notes").val()}},Games.prototype.validateSaveGameJson=function(a){var b=["title","platform","numcopies","numboxed","nummanuals"],c=b.filter(function(b){return""===a[b]});return{result:0===c.length?"success":"fail",fields:c}},Games.prototype.sortGames=function(a){var b=$("#gamesortfield"),c=$("#gamesortdir"),d=$("#gamerows"),e=c.val(),f="asc",g=null===d.val()?999999:d.val();b.val()==a&&(f=toggleSortDirection(e)),b.val(a),c.val(f);var h={field:a,sortdir:f,numrows:g};this.ajax.loadAjax("#games",urls.sortgames,h,this.initSorting)},Games.prototype.initSorting=function(a,b){"1"!==b&&(a=new Games(new Ajax,urls)),$("a.sortgamestitle").on("click",function(){a.sortGames("title")}),$("a.sortgamesplatform").on("click",function(){a.sortGames("platform")}),$("a.sortgamesnumcopies").on("click",function(){a.sortGames("numcopies")})},$(function(){var a=$(".picker"),b=a.val();a.datepicker(),a.datepicker("option","dateFormat","dd/mm/yy"),a.val(b);var c=new Ajax,d=new Games(c,urls);d.initSorting(d,"1"),$("input.saveButton").on("click",function(a){var b="save-game-loading-gif",e=$("input"),f=$("input.saveButton"),g=function(){return"/editgame"===document.location.pathname?d.updateGame:"/addgame"===document.location.pathname?d.saveGame:void 0},h=g();a.preventDefault(),doLoading(f,b,e),$("textarea").attr("disabled","true"),$("select").attr("disabled","true"),h(d,c).done(function(){document.location="/allgames"}).fail(function(a){a.fields&&showFailure(a.fields,"game")}).always(function(){finishedLoading(b,e),$("textarea").removeAttr("disabled"),$("select").removeAttr("disabled")})}),$("a.yesDelete").on("click",function(a){var b=$("form").find("input"),c=$("a.yesDelete"),e="delete-platform-loading-gif";a.preventDefault(),doLoading(c,e,b),$("textarea").attr("disabled","true"),$("select").attr("disabled","true"),d.deleteGame().done(function(){document.location="/allgames"}).always(function(){finishedLoading(e,b),$("textarea").removeAttr("disabled"),$("select").removeAttr("disabled")})})});
//# sourceMappingURL=script.min.js.map